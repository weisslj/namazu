1999-09-01  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/conf.c (show_conf): Modify messages.

	* src/mknmz.pl.in, lib/var.pl.in: Rename an variable:
	%conf::Supported -> %var::Supported 
	
	* src/mknmz.pl.in: Add --show-config option and implement
	show_config() function. 

	* src/mknmz.pl.in (put_log): Modify loggin messages a bit.
	
	* tknamazu/Makefile.am (CLEANFILES): Add $(bin_SCRIPTS).
	
	* template/NMZ.head.{en,ja}: Abolish using "format={short,long}" 
	but use "result=ext" instead.
	
	* src/cgi.[ch]: Implemented codes to handle result=ext in CGI
	query.
	
	* src/{namazu,usage}.c: Add --result=ext option for specifying
	NMZ.result.ext.

	* src/{namazu,usage}.c: Change identifiers of  sevaral command
	line options.
	
	* src/namazu.c (parse_options): Be effective -s option.
	
	* src/result.l (print_hlist): Support choicing a correct
	NMZ.result.foobar file.
	
	* src/mknmz.pl.in (write_result_file): Support making multiple
	NMZ.result.* files.

	* template/NMZ.result.{normal,short}: New files.

	* template/NMZ.result: Removed
	
	* src/mknmz.pl.in, lib/var.pl.in, src/{hlist,search}.c:
	Implement codes to integrate NMZ.i and NMZ.w. [namazu-dev 294]

	* lib/util.pl (remove_tmpfiles): Add a condition to return if
	$var::Opt{debug} in the beginning of the function;
	
	* src/search.c: s/forward_match/prefix_match/g;
	s/backward_match/suffix_match/g;
	
	* src/mknmz.pl.in (load_document): Fix stupid bugs which I made
	yesterday. (I forgot preceding `$' mark for ref values)

 	* tknamazu/{Makefile.am,README.tknamazu}:
	s/tknamazu.xpm/tknamazu.ppm/g
	
	* tknamazu/tknamazu.tcl.in: Use .ppm instead of .xpm

	* tknamazu/tknamazu.ppm: New file.
	
	* tknamazu/tknamazu.xpm: Removed.


1999-09-01  NOKUBI Takatsugu  <knok@daionet.gr.jp>

	* src/mknmz.pl.in: exclude gfilter.pl from filters/*.pl in 
	load_mocules() functions.

	
1999-08-31  NOKUBI Takatsugu  <knok@daionet.gr.jp>

	* lib/wakati.pm: Fix `tmpname' function name typo.

	* lib/var.pl, src/mknmz.pl.in: Add %REQUIRE_CODECONV variable.

	* filter/*.pl: Add codeconv() function.

	* filter/man.pl: Add codeconv::toeuc() before man_filter().

	* filter/pdf.pl: Add `-q' option with $pdfconvpath program.

	* lib/util.pl: Add filesize() function.

	* src/mknmz.pl.in: Add filesize check before reading file.

	* src/mknmz.pl.in: Add %Supported check.

	* filter/*.pl, src/mknmz.pl.in: Add return value on filter::filter()
	functions.


1999-08-31  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in (load_document): Move some codes from the bottom
	to "if (defined $var::REQUIRE_CODECONV{$mtype}) {}" block.
	
	* filter/mailnews.pl (filter): Add mailnews_citation_filter()
	process. (this fix an awful bug...)
	
	* conf/Makefile.am (mknmz.conf-dist): Modify regex for perl to
	treat %, @ prefixes as well as $.
	
	* Makefile.am (EXTRA_DIST): Add namazu.spec.
	
	* Makefile.am (DIST_SUBDIRS): Remove File-MMagic because it causes
	error at "make dist" time.
	
	* lib/var.pl.in: Remove serveal media types from
	%REQUIRE_CODECONV. (undo)

	* src/result.l (get_field_data): Insert commas if given filed is a
	numeric string.
	
	* src/util.c: Add isnumstr() and commas() functions.
	
	* tknamazu/{Makefile.am,README.tknamazu}:
	s/tknamazu.gif/tknamazu.xpm/g
	
	* tknamazu/tknamazu.tcl.in: Use .xpm instead of .gif

	* tknamazu/tknamazu.xpm: New file.
	
	* tknamazu/tknamazu.gif: Removed.
	
	* lib/var.pl: Add serveal media types into %REQUIRE_CODECONV.
	
	* src/mknmz.pl.in (generate_uri): Modify a way of applying eval.
	
	* src/mknmz.pl.in, lib/usage.pl: Add --update=s and implement
	its codes.

	* src/mknmz.pl.in, lib/usage.pl: Add --deny=s --exclude=s and
	implement their codes.
	
	* src/mknmz.pl.in: Modify it to be able to take multiple targets
	as command line arguments.
	
	* lib/util.pl: Modify cdie() to use `exit' instead of `die'
	because `die' cause a annoying message for ordinary users. :-)
	
	* src/mknmz.pl.in, lib/usage.pl: Add --replace=s option for
	transforming URI. And abolish a PREFIX argument in command line.
	
	* filter/gfliter.pl, filter/mailnews.pl: Move uuencode_filter()
	from gfilter.pl to mailnews.pl.
	
	* filter/html.pl: s/url/uri/g;
	
	* lib/conf.pl.in: Change $DEFAULT_FILE: _default -> index.html

1999-08-31  Ryuji Abe <raeva@t3.rim.or.jp>

	* Makefile.am: If configured, tknamazu will be built. Changed to 
	  use dist-hook section to distribute namazu.spec.

	* configure.in: Bumped version to 1.90. Added tknamazu configuration.

	* namazu.spec.in: Deleted COMMITTERS at %files.

	* src/Makefile.am: Cleaned up.

	* tknamazu/README: Renamed README.tknamazu.

	* tknamazu/Makefile.am: New file.

	* tknamazu/Makefile.in: Likewise.

	* tknamazu/tknamazu.tcl: Renamed tknamazu.tcl.in with autoconfize.

	* tknamazu/Makefile: Removed.

	* tknamazu/Makefile.W32: Likewise.

	* tknamazu/tknamazu.sample: Likewise.

	* tknamazu/tknamazu.bat.sample: Likewise.


1999-08-30  NOKUBI Takatsugu  <knok@daionet.gr.jp>

	* lib/codeconv.pl: Fix `tmpname' function name typo.

	* Makefile.am: Ignore test command return value on 
	  install-data-local target.

	
1999-08-30  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* Makefile.am (install-data-local): Remove codes creating
	namazu.conf and mknmz.conf.
	
	* src/mknmz.pl.in lib/util.pl: Move remove_tmpfiles from
	src/mknmz.pl.in to lib/util.pl. And modify it.
	
	* lib/util.pl: Add `cdie()' function to remove temporary files
	before mknmz die. mknmz MUST always dies with this function.
	
	* src/mknmz.pl.in (read_config): Use `do' instead of `require' for
	multiple calling of read_config().
	
	* lib/conf.pl: New file for containing default values which may
	overriden by mknmz.conf or ~/.mknmzrc
	
	* conf/mknmz.conf-dist.in: Removed
	
	* conf/Makefile.am : New file for creating mknmz.conf-dist at make
	time.
	
	* src/Makefile.am (install-data-local): Add codes to Removed
	`Makefile*' in the install directory. (for `conf' directory)

	* conf/mknmz.conf-dist.in: Append "|.*\.pdf|.*\.doc" regex into
	$ALLOW_REGEX for handling pdf and msword documents by default.
	And remove `_default' target.
	
	* src/mknmz.pl.in, conf/mknmz.conf: Abolish $FILE_SIZE_LIMIT but
	introduce $TEXT_SIZE_MAX instead for handling binary files such as
	pdf and msword.

	* src/mknmz.pl.in, lib/usage.pl: Abolish the following options and
	  remove their codes.
	    -R, --no-regex-index
	    -W, --no-date-index
	    -X, --no-field-index
	    -M, --no-mhonarc
	    -L, --no-line-adjust
	    -h, --rfc822   (dummy option alives)
	    -u, --uuencode (dummy option alives)
	    -r, --man

	* src/mknmz.pl.in, lib/usage.pl: Change the option letter for 
	`--lang=s': `-l' -> `-L'

	* filter/*.pl: s/ unless \$var::Opt{NoLineAd};/;/
	
	* **/*.pl{,.in}: Lower all keys of %var::Opt.
	
	* src/mknmz.pl.in: Remove all codes like "while (<$fh>)"
	because of its deanger. ($_ is a global value)
	
	* src/mknmz.pl.in, lib/var.pl: Abolish NMZ.{total,keys} and
	instead introduce NMZ.status for their values.
	
	* src/mknmz.pl.in (put_registry): Fix a variable name typo.
	
	* filter/*.pl: Change timing of dosing util::tmpnam()

	* lib/util.pl (tmpnam): Name file name with $var::OUTPUT_DIR
	
	* src/mknmz.pl.in, lib/var.pl: Change all NMZ.* file name
	representations using %var::NMZ instead of %var::File. 

	* src/mknmz.pl.in (make_headfoot): Fix $templatedir2.
	
	* src/{namazu,message}.c: Rename options: s/--hit-count/--count/
	s/output-file/output/
	
	* lib/util.pl: Remove useless codes from dprint and vprint.

	
1999-08-29  masao@ulis.ac.jp (Masao Takaku)

	* src/search.c: Ignore TOO_MUCH_HIT word in phrase query.

	
1999-08-29  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in (make_field_index): Add codes to set '(unknown)'
	to $fields->{'from'} when it's not set.
	
	* src/Makefile.am: Fix lacks of noinst_HEADERS
	
	* lib/util.pl (readfile): Comment out $conf::FILE_SIZE_LIMIT
	condition codes.
	
	* src/mknmz.pl.in: Abolish use of $size argument and modify size
	handling to treat a binary file well such as .gz, .pdf, .doc. 

	* filter/*.pl: Abolisu use of $size argument.

	* src/mknmz.pl.in: Abolish use of $ctrl in check_file() and
	load_document().

	* lib/util.pl (checkcmd): Fix a typo.
	
	* filter/mhonarc.pl (mediatype): Fix typos.

	* filter/*.pl: s/\$contents/\$contref/g
	
	* src/mknmz.pl.in: Change timing of code conversion.
	
	* lib/codeconv.pl: Add eucto() function.

	* src/mknmz.pl.in: Remove codeconv() function.
	
	* filter/rfc.pl (rfc_filter): Fix bad use of
	html::encode_entity()
	
	* src/mknmz.pl.in: Remove istext() function.

	* src/mknmz.pl.in (load_document): Use File::check_binary()
	instead of istext().
	
	* filter/html.pl (get_title): Fix.

	* src/mknmz.pl.in (namazu_core): Remove $url.
	
	
1999-08-28  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in: Add istext() and codeconv() functions.
	
	* src/mknmz.pl.in (load_document): Move a place of codes of code
	conversion because its timing was bad.

	* filter/gfilter.pl: New file.
	
	* filter/*.pl: s/filter ($$$$$$$)/filter ($$$$$$)/

	* src/mknmz.pl.in: s/checktype_content/checktype_contents/
	
	* src/mknmz.pl.in: Add global variable $TestMode for testing.
	
	* configure.in: Add --enable-test option for testing.
	
	* src/search.c (hash): Modify "j % 4" -> "j & 03"

	* src/mknmz.pl.in (hash): Modify "$i % 4" -> "$i & 03"

	* lib/seed.pl: New file (rename <- seed.pl)

	* lib/hash.pl: Remove   (rename -> seed.pl)
	
	* src/mknmz.pl.in: Add `readconf()' function.
	
	* lib/util.pl: Modify `dprint' and `vprint' to print prefix
	characters everytime.
	
	* src/mknmz.pl.in: Print a mediatype at processing time by
	default.
	
	* filter/*.pl: Modify them to use `vprint()' to print verbose
	messages. 

	* filter/*.pl: Fix typos.

	* lib/util.pl: Add funtion called 'vprint()' for printing verbose
	messaegs. 
	
	* filter/supported.pl: Removed
	
	* Makefile.am (EXTRA_DIST): Add ChangeLog.old.1.gz
	
	* ChangeLog.old.gz: Old ChangeLog (separated)
	
	* ChangeLog: Separate.
	
	* lib/usage.pl: Convert ISO-2022-JP -> EUC-JP

	* filter/pdf.pf: Remove @PDFTOTEXT_PATH@.

	* filter/gzip.pl: Remove @GZIP_PATH@.
	
	* ChangeLog: Change order to place a latest log on the top. 
	
	* Makefile.am (install-data-local): Add codes to creat configs
	file if no config files exist. 

	* src/{mknmz.pl.in,Makefile.am}: Add codes to handle CONFDIR.

	* **/*.pl{,.in}: Move non-config variables from conf:: to var::.

	* lib/conf.pl.in: Removed

	* **/*.pl{,.in}: s/foreach /for /g;

	* conf/mknmz.conf-dist.in: New file.

	* configure.in: Modify AC_OUTPUT.

	* lib/var.pl.in: New file.

	* lib/namazu.conf-dist: Remove.

	* configure.in: Remove filter command detection codes.

	* filter/rfc.pl.in: Fix rfc_filter();

	* filter/msword.pl.in: Fix status();

	* filter/mailnews.pl: Fix mailnews_filter arguments.

	* filter/html.pl: Fix html_filter() arguments.

	* filter/mhonarc.pl: Fix a typo.

	* **/*.pl{,.in}: Restore prefix `util::'

	* src/*.[ch]: Rename HLIST_MAXMAX -> RESULT_MAX.
	
	
1999-08-27  NOKUBI Takatsugu  <knok@daionet.gr.jp>

	* lib/util.pl: Add checkcmd function.

	* filter/*.pl, src/mknmz.pl.in: Implement dynamic command ditection.

	* lib/conf.pl.in: Add %supported variable.

	
1999-08-27  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in: Silence warnings.
	
	* src/*.[ch]: Rearrange many codes.

	* src/{var.c,var.h,em.h,magic.h,critical.h}: New files.

	* src/{type.h,values.c,variable.h,enum.h}: Remove.

	* lib/html.pl: Remove.

	* Makefile.am: Add AUTOMAKE_OPTIONS = no-dependencies

	* src/*.[ch]: Rename variables for NMZ.* files.

	* mknmz, namazu: Change behavior when no arguments are given to
	show simple messages like "Try `namazu --help' for more options."
	by using show_mini_usage().

	* src/mknmz.pl.in: Add show_mini_usage();

	* src/mknmz.pl.in, filter/*, lib/*: s/util:://g

	* lib/util.pl: Remove `package util'

	* lib/util.pl: Rename some functions

	* src/mknmz.pl: Rename some functions

	* Makefile.am, src/Makefile.am: Change packagedir (omit @VERSION@)
	[namazu-dev 192]

	
1999-08-26  Ryuji Abe <raeva@t3.rim.or.jp>

	* Makefile.am: Added namazu.spec to EXTRA_DIST and removed rpm target.
        
	* configure.in: Added AC_OBJEXT macro.
        
	* namazu.spec.in: See %changelog section.

	
1999-08-26  NOKUBI Takatsugu  <knok@daionet.gr.jp>

	* filter/*, lib/filter.pl, src/mknmz.pl.in: Fix $title probrem.

	
1999-08-26  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* src/configure.in: Add codes to make filter/supported.pl.
	[namazu-dev 199]

	* configure.in: Add codes to detect Compress::Zlib module.
	
	* src/Makefile.am: Add "libdir" macro.

	* Makefile.am: Change dist-hook: to remove CVS directories.

	* configure.in: Add codes to chedk "File::MMagic" module.

	* Makefile.am: Add "@FILE_MMAGIC@" into SUBDIRS

	* Makefile.am: Add "File-MMagic" into EXTRA_DIST

	* Makefile.am: Add CLEANDIRS entry (additional macro)

	* Makefile.am: Add "supported.pl" into CLEANFILES.

	* filter/supported.pl: New file.

	* src/configure.in, filter/{man.pl,compress.pl}: Substitute
	@{GROFF,ZCAT}_PATH@ for @OPT_HELPER_{GROFF,ZCAT}@.

	* src/util.c (die): Print program name in error message.

	* src/message.[ch]: Change a variable MSG_MIME_HEADER to macro.

	* src/values.c: Set HtmlOutout to 0.

	* Makefile.am: Modify install-data-local and dist-hook.

	* configure.in: Modify AC_OUTPUT according to removed files.

	* src/Makefile.am: Add an CLEANFILES entry.

	* src/{clnmz.in,rvnmz.in,vfnmz.in}: Removed files.

	* Makefile.am: Add an CLEANFILES entry.


1999-08-25  Satoru Takabayashi  <satoru-t@is.aist-nara.ac.jp>

	* Makefile.am, src/Makefile.am: Change a directory structure for
	installing.

		* src/mknmz.pl.in: Fix conflicted parts. (temporary)

* template/NMZ.*: New files.

	* lib/NMZ.*: Remove files.

	* src/{re.c,usage.c,message.c,field.c}: New files.

	* src/{cgi.h,field.h,hlist.h,parser.h,result.h,codeconv.h,form.h,
	message.h,re.h,search.h,variable.h,conf.h,type.h,wakati.h,enum.h,
	output.h,usage.h}: New files.

	* src/*.[ch]: Rerrange C coding styles.

	* configure.in, src/Makefile.am, src/wdnmz.in:
	Remove wdnmz.in

	
1999-08-25 NOKUBI Takatsugu <knok@daionet.gr.jp>

	* ChangeLog: merge conflicted parts.

1999-08-24 NOKUBI Takatsugu <knok@daionet.gr.jp>

	* lib/conf.pl.in, lib/filter.pl, lib/util.pl, src/mknmz.pl.in:
	  merge with knok-filter-1.

1999-08-23  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/namazu.c: Implement a suicide code.

	* src/mknmz.pl.in: Implement a signal handler for SIGINT (mknmz)

	* src/{hlist.c,result.l,output.c}, lib/NMZ.result: Implement a
	keyword emphasizing in HTML mode. (rough implementation)

	* src/form.c: Modified not to display ugly '<>' in a title of
	  HTML.

1999-08-23 NOKUBI Takatsugu <knok@daionet.gr.jp>

	* Makefile.am, configure.in: merge with knok-filter-1.
	* lib/util.pl: merge and add tnpnam function.

1999-08-13  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in: Change index formats of NMZ.[ip] to compress
	them.

	* src/search.c, src/hlist.c: Support new formats.
	  - NOTE: an old index format is no longer supported.

	* lib/NMZ.result: Modify a little bit.

	* src/conf.c, src/namazu.c: Modify LIST implementations a bit.

1999-08-12  masao@ulis.ac.jp (Masao Takaku)

	* src/search.c: Fix TfIdf scoring bug.

	* src/namazu.h, src/values.c: Delete NMZ.{f,fi} related code.
	
1999-07-22  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* configure.in: Add a feature to determine admin's email address
	automatically: imported the code from Apache's buildinfo.sh
	

1999-07-09  masao@ulis.ac.jp (Masao Takaku)

	* mknmz.pl.in: Fix field_indices bug occurred at re-exec

	* mknmz.pl.in: Fix -k and -c options bug

	* src/Makefile.am: Added getopt.c, getopt1.c, getotp.h entries 

1999-07-06  masao@ulis.ac.jp (Masao Takaku)

	* mknmz.pl: Fix --checkpoint, --include, --target-list
	related bugs.

	* Makefile.am, src/Makefile.am: Fix lib directory and
	add getopt.[ch]
	
1999-06-12  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/result.l: New file. formatter for search results 
	made by using lex

	* src/result.c: New file. made by lex automatically

	* src/{messages,search,form}.c: lower all HTML elements

	* lib/NMZ.*.{en,ja}: lower all HTML elements

	* lib/NMZ.results: New file. a template file for search results

	* src/regex.[ch]: Reimported sources from Ruby v1.2.5
	
1999-05-30  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/namazu.c: Modified it to use GNU getopt.c for parsing
	command line options and to support long-name options.

	* src/getopt.[ch], src/getopt1.c: GNU getopt.c added.
	
1999-05-29  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* lib/conf.pl.in: Modified a usage message in Japanese vastly.

	* src/mknmz.pl: Modified command line option parsing codes
	using Getopt::Long module.

	* src/cgi.c: Fixed validate_dbname() bug and
	  - [MAEDA Atusi <maeda@is.uec.ac.jp>] - patch

	* src/hlist.c: Fixed put_hlist bug
	  - [MAEDA Atusi <maeda@is.uec.ac.jp>] - report

	* src/namazu.c: Modified command line option parsing codes
	
1999-05-14  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl: Fixed lockfile related code (subtle problem)

	* lib/html.pl: Modified parse_robots_txt a little bit

	
1999-05-07  Satoru Takabayashi <satoru-t@is.aist-nara.ac.jp>

	* src/mknmz.pl.in: Fixed -F & -s option bug [namazu 647]
	  - [SHIOZAKI Takehiko <takehi-s@ascii.co.jp>] - report
	
