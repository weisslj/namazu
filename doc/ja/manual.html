<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
        "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<link rel=stylesheet href="namazu.css">
<link rev=made href="mailto:developers@namazu.org">
<title>Manual of Namazu</title>
</head>
<body lang="ja">
<h1>全文検索システム Namazu 説明書</h1>
<p> Last Modified: 2000-01-31
</p>
<hr>

<p>
Namazu の最新情報は <a
href="http://www.namazu.org/">http://www.namazu.org/</a> か
ら入手できます。Namazuは <a href="COPYING">GPL2</a> に従った
フリーソフトウェアです。完全に無保証です。
</p>

<h2>目次</h2>

<ul>
<li><a href="#organization">Namazuの基本構成</a>
<li><a href="#mknmz">mknmzコマンド</a>
  <ul>
  <li><a href="#mknmz-option">mknmzコマンド行引数</a>
  <li><a href="#mknmzrc">mknmzrcの設定</a>
  </ul>
<li><a href="#namazu">namazuコマンド</a>
  <ul>
  <li><a href="#namazu-option">namazuコマンド行引数</a>
  <li><a href="#namazurc">namazurcの設定</a>
  </ul>
<li><a href="#tools">付属ツール</a>
  <ul>
  <li><a href="#bnamazu">bnamazu</a>
  <li><a href="#nmzgrep">nmzgrep</a>
  <li><a href="#gcnmz">gcnmz</a>
  <li><a href="#mailutime">mailutime</a>
  <li><a href="#vfnmz">vfnmz</a>
  </ul>
<li><a href="#cgi">CGIとして利用する</a>
  <ul>
  <li><a href="#form">結果表示の件数と出力フォーマット</a>
  <li><a href="#idxname">ブラウザからインデックスを指定する方法</a>
  <li><a href="#multiple-indices">複数のインデックスに検索をかける方法</a>
  <li><a href="#subquery">検索対象のURIを制限する方法</a>
  </ul>
<li><a href="#query">検索式</a>
  <ul>
  <li><a href="#query-term">単一単語検索</a>
  <li><a href="#query-and">AND検索</a>
  <li><a href="#query-or">OR検索</a>
  <li><a href="#query-not">NOT検索</a>
  <li><a href="#query-grouping">グループ化</a>
  <li><a href="#query-phrase">フレイズ検索</a>
  <li><a href="#query-substring">部分一致検索</a>
  <li><a href="#query-regex">正規表現検索</a>
  <li><a href="#query-field">フィールド指定の検索</a>
  <li><a href="#query-notes">特記事項</a>
  </ul>
</ul>

<h2><a name="organization">Namazuの基本構成</a></h2>

<p>
Namazuは全文検索システムです。Namazu はインデックスの作成を
行う mknmz コマンドと、検索を行う namazuコマンドから構成され
ています。
</p>

<p>
大量の文書を高速に検索するためには、どの単語がどの文書で使わ
れているかを記録した索引ファイル (インデックス) をあらかじめ
作成する必要があります。インデックスはちょうど書籍の索引と似
ています。
</p>

<p>
インデックスを作成するには mknmz コマンドを用います。mknmz 
の引数にインデックス作成の対象とするディレクトリ名を与えます。
たとえば、 <var>/home/foo/public_html</var> を対象とするなら
ば
</p>

<p><code>% mknmz</code> <var>/home/foo/public_html</var>
</p>

<p>
と実行します。すると、 <var>/home/foo/public_html</var> 以下
の *.html *.txt といったファイルについて索引づけを行い、
mknmz を実行したディレクトリに NMZ.* というファイルを作成し
ます。この NMZ.* ファイルが Namazu のインデックスです。
</p>


<p>
作成されたインデックスに対して検索を行うには
<code>namazu</code>コマンドを用います。
</p>

<p><code>% namazu</code> <var>bar</var>
<var>/home/foo/NMZ/bar</var></p>

<p>
と実行すれば、/home/foo/NMZ/bar にあるインデックスに対してキー
ワード <var>bar</var> を検索します。
</p>


<h2><a name="mknmz">mknmzコマンド</a></h2>

<h3><a name="mknmz-option">mknmzコマンド行引数</a></h3>

<!-- mknmz-option -->
<pre>
    mknmz 1.9.14, Namazu のインデックス作成プログラム 
    
    使い方: mknmz [options] &lt;target&gt;...
    
    対象ファイル:
      -a, --all                すべてのファイルを対象とする
      -e, --robots-txt         ロボットよけされているファイルを除外する
      -t, --media-type=mtype   対象ファイルの文書形式を指定する
      -h, --mailnews           --media-type='message/rfc822' と同じ
          --mhonarc            --media-type='text/html; x-type=mhonarc' と同じ
      -A, --htaccess           .htaccess で制限されたファイルを除外する
      -F, --target-list=file   インデックス対象のファイルのリストを読み込む
          --allow=regex        対象ファイル名の正規表現を指定する
          --deny=regex         除外するファイル名の正規表現を指定する
          --exclude=regex      除外するパス名の正規表現を指定する
      -M, --meta               HTMLの metaタグをフィールド指定検索に用いる
      -r, --replace=code       URIを置換するためのコードを指定する
          --mtime=int          変更日制限 (int が 負で最近、正で古いものだけ、
                               例: -50 で 50 日以内、50 で 50 日より古いものだけ)
    
    形態素解析:
      -c, --use-chasen        日本語の単語のわかち書きに ChaSen を用いる
      -k, --use-kakasi        日本語の単語のわかち書きに KAKASI を用いる
      -m, --use-chasen-noun   名詞のみを抽出する
    
    文字列処理:
      -E, --no-edge-symbol  単語の両端の記号は削除する
      -G, --no-okurigana    送り仮名を削除する
      -H, --no-hiragana     平仮名のみの単語は登録しない
      -K, --no-symbol       記号をすべて削除する
    
    要約:
      -U, --no-encode-uri       URIのencodeを行わない
      -x, --no-heading-summary  HTML のヘディングによる要約作成を行わない
    
    
    インデックス作成:
          --update=index        更新するインデックスを指定する
      -Y, --no-delete           削除された文書の検出を行わない
      -Z, --no-update           文書の更新・削除を反映しない
    
    その他:
      -s, --checkpoint        チェックポイント機構を作動させる
      -f, --config=file       設定ファイルを指定する
      -I, --include=file      カスタマイズ用ファイルを読み込む
      -O, --output-dir=dir    インデックスの出力先を指定する
      -T, --template-dir=dir  NMZ.{head,foot,body}.* のディレクトリを指定する
      -q, --quiet             インデックス処理の最中にメッセージを表示しない
      -v, --version           ヴァージョンを表示する
      -V, --verbose           口やかましいモード
          --debug             デバッグモード
          --help              このヘルプを表示する
    
    バグ報告は &lt;bug-namazu@namazu.org&gt; へどうぞ
</pre>
<!-- mknmz-option -->


<h3><a name="mknmzrc">mknmzrcの設定</a></h3>
<p>
mknmzrc および .mknmzrc ではいくつかの設定が行えます。
mknmz は
</p>

<ol>
<li>$(sysconfdir)/$(PACKAGE)/mknmzrc<br>
通常は /usr/local/etc/mknmz/mknmzrc
<li>~/.mknmzrc
<li>-f, --config= オプションで指定した mknmzrc
</ol>

<p>
の順で設定ファイルを探して読み込みます。
</p>

<p>
インストール直後の状態では 
$(sysconfdir)/$(PACKAGE)/mknmzrc-sample というサンプルファイ
ルが用意されています。これを 
$(sysconfdir)/$(PACKAGE)/mknmzrc にコピーする、あるいは自分
のホームディレクトリに ~/.mknmzrc としてコピーして利用します。
</p>

<p>
mknmzrc の設定項目の説明は mknmzrc-sample ファイルにコメント
として書かれています。
</p>

<h2><a name="namazu">namazuコマンド</a></h2>

<h3><a name="namazu-option">namazuコマンド行引数</a></h3>

<!-- namazu-option -->
<pre>
    namazu 1.9.14, Namazu の検索プログラム
    
    使い方: namazu [options] &lt;query&gt; [index]...
        -n, --max=num           一度に表示する件数
        -w, --whence=num        表示する検索結果の先頭番号
        -l, --list              検索結果を URI・パス名をリストで出力
        -s, --short             短いフォーマットで出力
            --result=ext        結果表示に用いる NMZ.result.ext を指定
            --late              検索結果を新しい順にソートする
            --early             検索結果を古い順にソートする
            --sort=method       ソート方法を指定する (score, date, field:name)
            --ascending         ソートの方向を昇順にする (標準は降順)
        -a, --all               検索結果をすべて表示する
        -c, --count             ヒット数のみを表示する
        -h, --html              HTMLで出力する
        -r, --no-references     参考ヒット数を表示しない
        -H, --page              先の検索結果へのリンクを表示する (ほぼ無意味) 
        -F, --form              &lt;form&gt; ... &lt;/form&gt; の部分を強制的に表示する
        -R, --no-replace        URI の置き換えを行わない
        -U, --no-decode-uri     URI encode の復元を行わない
        -o, --output=file       指定したファイルに検索結果を出力する
        -f, --config=file       設定ファイルを指定する
        -C, --show-config       設定を表示する
        -q, --quiet             検索結果以外のメッセージを表示しない
        -v, --version           ヴァージョンを表示する
            --help              このヘルプを表示する
    
    バグ報告は &lt;bug-namazu@namazu.org&gt; へどうぞ
</pre>
<!-- namazu-option -->

<p>
<code>% namazu [options] &lt;query&gt; [index]...</code>
</p>

<p>
のように実行する形になっています。<code>[index
dir]...</code> は検索対象となるインデックスの置いてあるディ
レクトリの指定です。
</p>

<p>
コマンド行から実行したときは標準でプレインなテキストとし
て検索結果の表示を行います。HTML で出力する場合には -h オプ
ションを使います。CGI から検索したときは結果が一度に表示でき
ないと下の方に [1] [2] [3] のように先の検索結果へ進むための
リンクが作られますが、コマンド行から実行したときにはこれ
らの表示は無意味なので、表示しません。この余分な表示を何らか
の理由によって強制的に表示させるには -H オプションを使います。
また、コマンド行から実行したときは標準で &lt;form&gt;
... &lt;/FORM&gt; を表示させないようになっていますが、 -F を
つけると強制的に表示させることができます。
</p>

<p>
-a オプションは検索結果をすべて表示させます。
</p>

<p>
検索結果の 21 件目から 40 件目までを表示させたいという場合には 
<code>-n 20 -w 20</code> のように指定します。
-w の値が 21 でないところに注意してください。
</p>

<p>
-U オプションはコマンド行から実行して plain text で結果出力する際に URI encode のデコードを行わないためのオプションです。標準では行われるようになっています。
</p>

<h3><a name="namazurc">namazurcの設定</a></h3>
<p>
namazurc および .namazurc ではいくつかの設定が行えます。
namazu は
</p>

<ol>
<li>$(sysconfdir)/$(PACKAGE)/namazurc<br>
通常は /usr/local/etc/namazu/namazurc
<li>~/.namazurc
<li>-f, --config= オプションで指定した namazurc
</ol>

<p>
の順で設定ファイルを探して読み込みます。
</p>

<p>
インストール直後の状態では 
$(sysconfdir)/$(PACKAGE)/namazurc-sample というサンプルファイ
ルが用意されています。これを 
$(sysconfdir)/$(PACKAGE)/namazurc にコピーする、あるいは自分
のホームディレクトリに ~/.namazurc としてコピーして利用します。
</p>

<p>
namazurc の設定項目の説明は namazurc-sample ファイルにコメント
として書かれています。
</p>

<h2><a name="tools">付属ツール</a></h2>

<h3><a name="bnamazu">bnamazu</a></h3>

<p>
bnamazu は Webブラウザと連携して検索を行うツールです。検索結
果を Webブラウザ (標準では lynx) に渡して閲覧できます。コマ
ンド行から次のように実行します。
</p>

<p>
<code>% bnamazu [-n] [-b browser] [namazu's options] &lt;query&gt; [index]...</code>
</p>

<h3><a name="nmzgrep">nmzgrep</a></h3>

<p>
nmzgrep は namazu コマンドと連携して egrep を実行するツール
です。検索にヒットした文書に対して、egrepをかけます。コマン
ド行から次のように実行します。
</p>

<p>
<code>% nmzgrep [egrep's options] &lt;pattern&gt; [index]...</code>
</p>


<h3><a name="gcnmz">gcnmz</a></h3>

<p>
gcnmz はインデックスを掃除するツールです。コマン
ド行から次のように実行します。
</p>

<p>
<code>% gcnmz [options] &lt;target&gt;...</code>
</p>

<h3><a name="mailutime">mailutime</a></h3>

<p>
mailutime は Mail/News のファイルのタイムスタンプを Date: ヘッ
ダに合わせるツールです。コマンド行から次のように実行します。
</p>

<p>
<code>% mailutime &lt;target&gt;...</code>
</p>

<h3><a name="vfnmz">vfnmz</a></h3>

<p>
vfnmz は検索結果の表示を preview するツールです。コマンド行
から次のように実行します。
</p>

<p>
<code>vfnmz &lt;index&gt; [NMZ.result.foobar]</code>
</p>


<h2><a name="cgi">CGIとして利用する</a></h2>

<h3><a name="form">結果表示の件数と出力フォーマット</a></h3>

<p>標準で作成される NMZ.head には</p>

<p>
<code>&lt;p&gt;</code><br>
<code>&lt;strong&gt;一度に表示する件数:&lt;/STRONG&gt;</code><br>
<code>&lt;select name="max"&gt;</code><br>
<code>&lt;option value="10"&gt;10</code><br>
<code>&lt;option selected value="20"&gt;20</code><br>
<code>&lt;option value="30"&gt;30</code><br>
<code>&lt;option value="50"&gt;50</code><br>
<code>&lt;option value="100"&gt;100</code><br>
<code>&lt;/select&gt;</code><br>
<code>&lt;strong&gt;文書の要約表示:&lt;/STRONG&gt;</code><br>
<code>&lt;select name="format"&gt;</code><br>
<code>&lt;option selected value="long"&gt;ON</code><br>
<code>&lt;option value="short"&gt;OFF</code><br>
<code>&lt;/select&gt;</code><br>
<code>&lt;/p&gt;</code><br>
</p>

<p>
のように記述され、ブラウザ側から結果表示の件数と出力フォーマットを
指定できるようになっています。
</p>


<h3><a name="idxname">ブラウザからインデックスを指定する方法</a></h3>

<p>
ブラウザから複数のインデックスの中からひとつを選べるように設
定できます。
</p>

<p>
<code>&lt;strong&gt;検索対象:&lt;/STRONG&gt;</code><br>
<code>&lt;select name="idxname"&gt;</code><br>
<code>&lt;option selected value="</code><var>foo</var><code>"&gt;</code><var>foo</var><br>
<code>&lt;option value="</code><var>bar</var><code>"&gt;</code><var>bar</var><br>
<code>&lt;option value="</code><var>baz</var><code>"&gt;</code><var>baz</var><br>
<code>&lt;/select&gt;</code><br>
</p>

<p>
のような記述をいれておくことで、 <var>foo, bar, baz</var> の
中からデータベースの指定ができるようになります。この選択の要
素はいくつあっても構いません。<var>foo</var> が選ばれた時は 
namazurc の <code>Index</code> で設定されたディレクトリの下
にある <var>foo</var> というディレクトリにある NMZ.* を元に
検索することになります。 <code>Index</code> が 
<code>/usr/local/var/namazu/index</code> の場合は下のような
ディレクトリ構造になります。
</p>

<pre>
        /
        + usr/
          + local/
            + namazu/
              + index/
                + <var>foo</var>/
                + <var>bar</var>/
                + <var>baz</var>/
</pre>

<p>
また、その <var>foo, bar, baz</var> にある各 NMZ.head にもそれぞれ
上のような記述をいれておかなければなりません (selected はつけなく
てもいいです)。action の指定についてもすべての NMZ.head で同じ物を
指定しておきます。標準で作成される NMZ.head にはこのデータ
ベース指定の設定は記述されていないので、必要のある人は各自で追加し
てください。
</p>

<p>
&lt;input type="hidden" name="idxname" value="foo"&gt;
</p>

<p>
のように INPUT を HIDDEN 属性にしてこっそり指定しておくこともできます。
</p>

<h3><a name="multiple-indices">複数のインデックスに検索をかける方法</a></h3>
<p>
&lt;form&gt; ... &lt;/FORM&gt; 
の中に下のような記述を入れてください。
</p>

<p>
&lt;strong&gt;対象インデックス&lt;/STRONG&gt;&lt;BR&gt;<br>
&lt;ul&gt;<br>
&lt;li&gt;&lt;input type="checkbox" name="idxname"
        value="foo"   checked&gt;foo<br>
&lt;li&gt;&lt;input type="checkbox" name="idxname"
        value="bar" checked&gt;bar<br>
&lt;li&gt;&lt;input type="checkbox" name="idxname"
        value="baz"   checked&gt;baz<br>
&lt;/ul&gt;<br>
</p>

<p>
このように記述しておくことで foo, bar, baz から複数選択して
検索できます。検索結果に使われる NMZ.head, NMZ.foot は 
namazurc の Index で指定したディレクトリにあるものが使われま
す (または namazurc の中で INDEX の項目で指定したディレクト
リにあるもの)。インデックスの指定がひとつだった場合には個々
の NMZ.head, NMZ.foot が使われる点に注意してください。これを
回避したい場合にはすべての NMZ.head, NMZ.foot を共通にしてし
まうことです。
</p>


<h3><a name="subquery">検索対象のURIを制限する方法</a></h3>

<p>
CGI に subquery の値を渡すことで実現できます。たとえば以下のように
指定すると良いでしょう。一番下の行は検索結果の「参考ヒット数」の表
示を抑制するためのおまじまないです。
</p>

<p>
&lt;strong&gt;検索対象&lt;/STRONG&gt;<br>
&lt;select name="subquery"&gt;<br>
&lt;option value=""&gt;全体<br>
&lt;option value="+uri:/^http://foo.bar.jp/aaaa//"&gt;aaaaのコーナー<br>
&lt;option value="+uri:/^http://foo.bar.jp/bbbb//"&gt;bbbbのコーナー<br>
&lt;option value="+uri:/^http://foo.bar.jp/cccc//"&gt;ccccのコーナー<br>
&lt;option value="+uri:/^http://foo.bar.jp/dddd//"&gt;ddddのコーナー<br>
&lt;/select&gt;<br>
&lt;input type="hidden" name="reference" value="off"&gt;<br>
</p>

<p>
subquery には +URI: 固定ではなく任意の検索式を指定できます。
</p>


<!-- query -->
<h2><a name="query">検索式</a></h2>

<h3><a name="query-term">単一単語検索</a></h3>
<p>
調べたい単語を一つ指定するだけのもっとも基本的な検索手法です。
例: 
</p>

<p class="example">
namazu
</p>

<h3><a name="query-and">AND検索</a></h3> 

<p>
ある単語とある単語の両方を含む文書を検索します。検索結果を絞
り込むのに有効です。3つ以上の単語を指定することも可能です。
単語と単語の間に <code class="operator">and</code> を挿みます。例:
</p>

<p class="example">Linux and Netscape</p>

<p>
<code class="operator">and</code> は省略できます。単語を空白で区切って羅列す
るとそれらの語すべてを含む文書をAND検索します。
</p>

<h3><a name="query-or">OR検索</a></h3>
<p>
ある単語とある単語のどちらかを含む文書を検索します。3つ以上
の単語を指定することも可能です。単語と単語の間に 
<code class="operator">or</code> を挿みます。例: 
</p>

<p class="example">
Linux or FreeBSD
</p>

<h3><a name="query-not">NOT検索</a></h3>
<p>
ある単語を含み、ある単語を含まない文書を検索します。3つ以上
の単語を指定することも可能です。単語と単語の間に 
<code class="operator">not</code> を挿みます。例: 
</p>

<p class="example">
Linux not UNIX
</p>

<h3><a name="query-grouping">グループ化</a></h3>
<p>
AND検索、OR検索、NOT検索を括弧でグループ化できます。括弧の両
隣には空白を入れる必要があります。例:
</p>

<p class="example">
( Linux or FreeBSD ) and Netscape not Windows
</p>

<h3><a name="query-phrase">フレイズ検索</a></h3>
<p>
2語以上からなる複合語を検索します。 <code
class="operator">"..."</code> と2重引用符で、あるいは <code
class="operator">{...}</code> と中括弧で囲みます。Namazuのフ
レイズ検索は精度が 100 % ではないため、ときどき誤ることがあ
ります。例: </p>

<p class="example">
{GNU Emacs}
</p>

<!-- foo
<p>
Tknamazu および namazu.el から検索するときは必ず後者で指定します。
</p>
-->

<h3><a name="query-substring">部分一致検索</a></h3>
<p>
部分一致検索には前方一致、中間一致、後方一致の 3種類があります。
</p>

<dl> 
<dt>前方一致検索
<dd><code class="example">inter*</code>
(<code>inter</code> から始まる単語を含む文書を検索)
<dt>中間一致検索
<dd><code class="example">*text*</code>
(<code>text</code> を内包する単語を含む文書を検索)
<dt>後方一致検索
<dd><code class="example">*net</code>
(<code>net</code> で終わる単語を含む文書を検索)
</dl>


<h3><a name="query-regex">正規表現検索</a></h3>

<p>
検索するキーワードを正規表現で指定します。正規表現は 
<code class="operator">/.../</code> のようにスラッシュ記号で囲みます。正規表
現のエンジンには<a
href="http://www.netlab.co.jp/ruby/">Ruby</a>のコードを利用
しています。正規表現の書式は<a
href="http://www.perl.com/">Perl</a>とほぼ同じです。 例:
</p>

<p class="example">
/インター?フェ[イー]ス/
</p>


<h3><a name="query-field">フィールド指定の検索</a></h3>
<p>
<code>Subject:</code>, <code>From:</code>,
<code>Message-Id:</code> といったフィールドを指定して検
索する手法です。特にMail/News のファイルを扱う際に効果を発揮
します。例:
</p>

<ul>
<li><code class="example">+subject:Linux</code><br>
(Subject: に <code>Linux</code>が含まれる文書)
<li><code class="example">+subject:"GNU Emacs"</code><br>
(Subject: に <code>GNU Emacs</code>が含まれる文書)
<li><code class="example">+from:foo@bar.jp</code><br>
(From: に <code>foo@bar.jp</code> が含まれる文書)
<li><code class="example">+message-id:&lt;199801240555.OAA18737@foo.bar.jp&gt;</code><br>
(Message-Id を指定)
</ul>

<h3><a name="query-notes">特記事項</a></h3>

<ul>
<li>いずれの検索方法でもアルファベットの大文字・小文字の区別
はしません。

<li>日本語の複合語は形態素単位に分割し、それらを<a
href="#phrase"> フレイズ検索</a>します。分割は不適切に行なわ
れることがあります。

<li>JIS X 0208 (いわゆる全角文字) の英数字と記号の一部 
(ASCIIと重複しているもの) は ASCII (いわゆる半角文字) として
処理されます。

<li>記号を含む語の検索ができます。例: <code>TCP/IP</code>。
ただし、記号の処理は完全ではないので <code>TCP and IP</code> 
のように分割して<a href="#and">AND検索</a>をかけた方が取りこ
ぼしがありません (その代わり余計なファイルまでヒットしてしま
う可能性があります)。

<li>中間一致・後方一致、正規表現、フィールド指定の検索には少
し時間がかかります。

<li><code class="operator">and</code>, <code
class="operator">or</code>, <code
class="operator">not</code> を単語として検索したいときはそれ
ぞれ、 <code class="operator">"..."</code> と2重引用符で、
あるいは <code class="operator">{...}</code> と中括弧で囲みます。 

<!-- foo
Tknamazu および namazu.el から検索するときは必ず後者で指定します。
-->

</ul>
<!-- query -->

<hr>
<p>
<a href="http://www.namazu.org/">Namazu Homepage</a>
</p>
<div class="copyright">
Copyright (C) 2000 Namazu Project. All rights reserved.
</div>
<div class="id">
$Id: manual.html,v 1.4 2000-01-31 08:56:46 satoru Exp $
</div>
<address>
developers@namazu.org
</address>
</body>
</html>
