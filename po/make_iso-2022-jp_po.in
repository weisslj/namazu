#! @PERL@
my $c_format = 0;

open(IN, "ja.po") || die;
open(OUT, ">ja_JP.ISO-2022-JP.po") || die;

while (<IN>) {
    s/charset=EUC-JP/charset=ISO-2022-JP/;
    s/Content-Transfer-Encoding: 8-bit/Content-Transfer-Encoding: 7-bit/;
    $c_format = 1 if /^\#, c-format/;
    $c_format = 0 if /^$/;

    s/([\xa1-\xfe]+)/\\033\\044\\102$1\\033\\050\\102/g;
    s/([\xa1-\xfe])/escape($1)/ge;
    print OUT;
}

sub escape { 
    my ($c) = @_;
    $c =~ tr/\xa1-\xfe/\x21-\x7e/;
    return sprintf("\\%03o", ord($c));
}
