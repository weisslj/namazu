<html> 
<head>
<title>NetBSD/Namazu 2.0 tutorial</title>
<meta     name = "Keywords" content = "Namazu,install,kasasi,chasen,インストール,全文検索"
>
</head>
<!--------------------------><a name="BEGIN">
<!--------------------------><a name="REF">
<body>
<a name="INDEX"></a>
<h2>Namazu 2.0 tutorial</h2>
Namazu 2.0 を初めて使う方のための情報を用意して見ました。
<p>
この文章は、2.0 が Release の形で公開されたことを前提として
書いています。公開される前にこの文章をお読みになる場合、
<ul>
<li>cvs または snapshot 版の入手
<li>m4 1.4, automake, autoconf, libtool の設置
<li>./autogen.sh の実行
</ul>
が必要になります。それらについては 
<a href="diary.shtml">cvs 版について</a>も参照して下さい。

<h3>目次</h3>
  <ul>
  <li><a href="#MISSION">本文の目的</a>
  <li><a href="#REFERENCE">参照</a>
  <li><a href="#VERSIONS">四つの版</a>
  <li><a href="#COMPONENTS">Namazu の構成部品</a>
  <li><a href="#PREP_MAKE">準備と make</a>
  <li><a href="#BEFORE_MAKE_INSTALL">mknmz make install 前の確認</a>
  <li><a href="#HELP">help を表示</a>
  <li><a href="#RUN_MKNMZ">動作確認 mknmz</a>

  <li><a href="#RUN_NAMAZU">動作確認 namazu</a>
  <li><a href="#TERMINOLOGY">用語</a>
  <li><a href="#CAN_DO">Namazu で出来ること</a>
  <li><a href="#CAN_NOT_DO">Namazu で出来ないこと</a>
  <li><a href="#OTHERS">その他
  </ul>

<!-- ----------------------------------------------------- -->
<a name="MISSION"></a>
<h3><a href="#INDEX">本文の目的</a></h3>

<ul>
<li> Namazu-2.0 を初めて設置する方
<li> Namazu を初めて使う方、Namazu-2.0 を初めて使う方
</ul>
を対象に、Namazu を使い始める時の困難が少しでも少なくな
るようにという目的で書かれています。
Namazu の全ての機能については、
<a href="doc/ja/manual.html">説明書</a> がありますので、そちらを
参照して下さい。また設置についても
<a href="../../INSTALL.ja">別途説明</a>
があります。

<!-- ----------------------------------------------------- -->
<a name="REFERENCE"></a>
<h3><a href="#INDEX">【参照】</A></h3>
<dl>
<dt>Kakasi 2.3.1
  <dd>高橋裕信さんの作られた kakasi-2.2.5 を野首さん・馬場さんが修正して
  namazu 用などに使いやすくしたもの<br>
  <a href="http://kakasi.namazu.org/        ">http://kakasi.namazu.org/</a>
  <br>
  <font color="#226644">
(これが日本語で表示されない場合、
<a href="http://www.apache.org/docs/content-negotiation.html">
content negotiation </a>
が適切に行なわれていない場合があります。
閲覧系の言語の設定に日本語(ja) を追加して見て下さい
       </font> )

<dt>開発配布元・高林さんからの情報
  <dd>
  <a href="http://openlab.ring.gr.jp/namazu/          ">http://openlab.ring.gr.jp/namazu/</a>
<dt> その中にある説明書
  <dd>
  <a href="http://openlab.ring.gr.jp/namazu/manual.html          ">http://openlab.ring.gr.jp/namazu/manual.html</a>
<dt>(同じく)良くある質問と答 (FAQ)日本語
  <dd>
  <a href="http://openlab.ring.gr.jp/namazu/FAQ.html          ">http://openlab.ring.gr.jp/namazu/FAQ.html</a>
<dt>Namazu メイリング・リスト
  <dd>
  <a href="http://openlab.ring.gr.jp/namazu/ml.html          ">http://openlab.ring.gr.jp/namazu/ml.html</a>
<dt>やまだあきらさんの namazu.el (Emacs/Mule client)
  <dd>
  <a href="http://arika.org/linux/tools/namazu-el/          ">http://arika.org/linux/tools/namazu-el/</a>
<dt>Namazu Beta version (proto)
  <dd>ここの説明で使っている 1.9.14 はここにある<br>
  現在は proto と unstable は同じもの
  <br>
  <a href="http://openlab.ring.gr.jp/namazu/proto/          ">http://openlab.ring.gr.jp/namazu/proto/</a>
</dl>

<!-- ----------------------------------------------------- -->
<a name="VERSIONS"></a>
<h3><a href="#INDEX">四つの版</a></h3>
Namazu の版には(大きく分けて) 1.3 以前, 1.4, 1.9, 2.0 の四つがあり
ます。
<dl>
<dt> 1.3
<dd> 
一番多く使われている。<br>
1.3.0.10 以前のものは
外部からファイル操作をされる可能性があるので、
その心配がある時には 1.3.0.11 に更新した方がいい。
<br>
1.3.0.11 が最新
<dt>1.4 
  <dd>Perl 部品を使った高速化が入った。<br>
  1.4.0.8 が最新
<dt>1.9
<dd>2.0 への開発中のものを時折まとめて公開したもの。<br>
1.9.12 以前のものには外部からファイル操作をされる可能性があります。
最新 1.9.13
<dt>2.0
  <dd>今回公開されたもの
<dt>2.0-current
  <dd>次の版に向けて開発の続いているもの
<a href="http://openlab.ring.gr.jp/namazu/development.html.ja">
2.0-current </a> は CVS で取得出来ます。
</dl>

<!-- ----------------------------------------------------- -->
<a name="COMPONENTS"></a>
<h3><a href="#INDEX">Namazu の構成部品</a></h3> 

namazu は大きく分けて次の二つから出来ています。 
<ul>
<li>mknmz<br> 
検索索引(index) を予め作る( perl で書いてある)。 
通常の使い方としては、cron などで定期的に実行させる。 (mew-nmz.el の
場合、Emacs から起動してくれる) <br> 
無指定では 結果の検索索引は現案内 (current directory) に出来る。 
 <li>namazu <br> 
実際に文字列を入力して検索する<br> 
例えば、cgi-bin として動かす時に使う。 
あるいは操作行 (command line) から使うことも出来る。 ( c で書いてある)
<font size=-1> 
<p>
1.9.13 からは、この操作行用 (namazu) と cgi-bin 
用 (namazu.cgi)が 「外部からの攻撃を受けないように」 
との理由で別物になっている。
namazu という名前のものを namazu.cgi という名前で写したり、名前を
変更して 使ってしまっては、
その意味がない。</font>
</ul> 
実際には、後者には、
 <A href="variation.shtml">いろいろな変種 (variation) </a>
が用意されていますが、ここではこまかいことは省略します。
<p>
<!----------------------------------- P R E P A R A T I O N  ----------------------><a name="MAKE"></a>
<a name="PREP_MAKE"></a>
<h3><a href="#INDEX">準備と make</a></h3>
2.0 の版を作るために次のものが必要になります。
(お名前の敬称は略させていただきます。ごめんなさい)
<table cellspacing=0 cellpadding=3 border=1>
<tr bgcolor="#E0E0E0">
<th>名称</th><th>説明</th>
<th>必須</th>
<th>最新版</th><th>必要な版</th>
<th>譜名</th>
<th>作成・配布</th>
<th>入手先(例)</th>
<th>その他</th>
</tr>
<!-- ---------------- P e r l ---------------------------------- -->
<tr><td>Perl</td><td>Perl <nobr>言語処理系</nobr>
<td>○</td><td>5.005_03</td><td>5.004</td>
<td>perl-5.005_03.tar.gz</td>
<td><nobr>Larry Wall</nobr>
GNU CPAN</td>
<td> 
<a href="ftp://ftp.lab.kdd.co.jp/lang/perl/CPAN/authors/id/GBARR/">
CPAN</a></td>
 <td><br></td>
</tr>

<!-- --------------- n k f ------------------------------- -->
<tr bgcolor="E0E0A0"><td>nkf</td><td>Network Kanji Filter <nobr>漢字コード</nobr> 
<nobr>変換系</nobr></td>
  <td>○</td><td>1.9</td><td><a href="nkf.shtml">1.71</a></td>
  <td rowspan=2>
  <a href="ftp://ftp.ie.u-ryukyu.ac.jp/pub/software/kono/nkf171.shar   ">nkf171.shar</a></td>
  <td rowspan=2><nobr>河野眞治</nobr></td>
  <td rowspan=2>
  <a href="ftp://ftp.ie.u-ryukyu.ac.jp/pub/software/kono/">琉球大学</a></td>
  <td><br></td>
  </tr>

<!-- -------------- N K F  ------------------------------ -->
<tr bgcolor="E0E0A0"><td>NKF</td><td>nkf <nobr>Perl 部品化</nobr></td>
  <td>▲</td><td>1.9</td><td>1.71</td>
  <td><br></td>
  </tr>
<!--------------------- K A K A S I ------------------------->
<tr bgcolor="#80B080">
 <td><a href="http://kakasi.namazu.org/index.html.ja">kakasi</a></td>
 <td>日本語・ <nobr>ローマ字</nobr> 変換系<td>△</td><td>2.3.1</td><td><=</td>
 <td><a href="ftp://kakasi.namazu.org/pub/kakasi/kakasi-2.3.1.tar.gz">
 kakasi-2.3.1.tar.gz</a></td>
 <td rowspan=2>
 <a href="http://www.daionet.gr.jp/~knok/"><nobr>野首貴嗣</nobr></a></td>
 <td rowspan=2>
 <a href="ftp://kakasi.namazu.org/pub/kakasi/">namazu.org</a>
  <td><br></td>
 </tr>
<!--------------------- T e x t :: K A K A S I ------------------------->
<tr bgcolor="#80B080">
  <td><a href="http://www.daionet.gr.jp/~knok/kakasi">Text::Kakasi</a></td>
  <td>Kakasi <nobr>Perl 部品化</nobr><td>▲</td>
  <td>1.00</td><td><=</td>
  <td>
  <a href="http://www.daionet.gr.jp/~knok/kakasi/Text-Kakasi-1.00.tar.gz">Text-Kakasi-1.00.tar.gz</a>
  </td>
  <td><br></td>
  </tr>

<!--------------------- C H A S E N 2 ----------------------------->
<tr bgcolor="#COE0C0">
  <td>Chasen</td>
  <td>(茶筌) -- <nobr>日本語</nobr> <nobr>形態素</nobr> <nobr>解析器</nobr></td>
  <td>△</td>
  <td>2.02</td><td><=</td><td>
  <a href=" ftp://ftp.aist-nara.ac.jp/pub/lab/nlp/tools/chasen/chasen-sys2.02-ipadic2.1.tar.gz ">chasen-sys2.02 -ipadic2.1.tar.gz</a>
  </td><td>
  <a href="http://cactus.aist-nara.ac.jp/lab/nlt/chasen.html        ">奈良先端大学</a> |
  <a href="ftp://ftp.aist-nara.ac.jp/pub/lab/nlp/tools/chasen/">ftp://</a>
  </td><td>
  <a href="http://cactus.aist-nara.ac.jp/lab/nlt/chasen/distribution.html        ">配布方針</a></td>
  <td>
  2.02 以前では libchasen.a について下記参照
  </tr>
<!--------------------- Text-Chasen-2 ----------------------------->
<tr bgcolor="#COE0C0">
  <td>Text::ChaSen</td>
  <td>ChaSen <nobr>Perl 部品化</nobr></td>
  <td>▲</td>
  <td>0.20</td><td><=</td><td>
  <a href="http://www.daionet.gr.jp/~knok/chasen/Text-ChaSen-0.20.tar.gz">
  Text-ChaSen-0.20.tar.gz</a></td>
  <td align=CENTER>
  <a href="http://www.daionet.gr.jp/~knok/chasen/">
  <nobr>野首貴嗣</nobr></a></td>
  <td><a href="http://www.daionet.gr.jp/~knok/chasen/        ">Text::ChaSen</a></td>
  <td><br></td>
</tr>
<!-- ------------------- g e t t e x t -----------------------  -->
<tr bgcolor="#E0E0E0"><td>gettext</td><td>Message localization</td>
<td>○</td><td>0.10.35</td><td><=</td>
<td><a href="ftp://ftp.iij.ad.jp/pub/GNU/gettext/">
gettext-0.10.35.tar.gz</a></td>
<td>FSF</td><td><a href="ftp://ftp.iij.ad.jp/pub/GNU/gettext/">GNU</td>
<td>
BSD make を使う場合は 
<a href="../../PATCHES.GT">PATCHES.GT</a>
を当てておく
</td>
<td>
<!-- ------------------- File-MMagic -------------------- -->
<tr><td>
<a href="http://search.cpan.org/search?mode=module&query=MMagic">File-MMagic</a>
</td><td>File 種別</td>
<td>×</td><td>0.19</td><td><=</td>
<td>File-MMagic-0.19
<td>
  <a href="http://www.daionet.gr.jp/~knok/">
  <nobr>野首貴嗣</nobr></a></td>
</td>
<td align=CENTER>
<a href="http://search.cpan.org/search?dist=File-MMagic">CPAN dist</a>
</td><td>
通常同梱されているので別途設置は不要
</td>
</tr>
<!-- ------------------- N a m a z u -------------------------  -->
<tr bgcolor="#ffffff"><td colspan=9>当然、次のものも必要です。
</td></tr>
<tr><td>Namazu</td><td>Namazu本体</td>
<td>○</td><td>1.9.14</td><td><=</td>
<td><a href="http://openlab.ring.gr.jp/namazu/proto/namazu-1.9.14.tar.gz">
namazu-1.9.14.tar.gz</a></td>
<td>
<a href="http://openlab.ring.gr.jp/namazu/">Project Namazu</a>
<td>
<a href="http://openlab.ring.gr.jp/namazu/proto/        ">namazu/proto/</a></td>
<td><br></td>
</tr>
</table>

<ul>
<li>
△ は (日本語の処理をするなら)
kakasi/ChaSen のどちらかが必要という意味。
<table cellspacing=0 cellpadding=3 border>
<tr><td>両方用意しておいた場合</td><td>
(無指定ではわかち書きに kakasi を使うが、茶筌も
-c とするだけで操作行で指定出来るようになります。)
<tr><td>片方しか用意していない場合</td><td>
./configure の時点でどちらを使うかが選ばれ、決められます。
</table>

<li>
▲ は <nobr>Perl 部品化</nobr>で、1.9/2.0 の機能を生かすには必要で
す。しかし、なくても動くことは動きます。
その場合には一つの譜毎にわかち書きの外部 process を起動するので、
遅くなります。その場合でも、
mknmz による索引の作成が遅いだけで、namazu の検索の
速度には関係ありません。でも、入れるのは 
<tt><nobr>perl Makefile.PL; make; make install</tt></nobr>
とするだけだから、問題がないなら入れておいた方がいいと思います。
<li>
namazu 1.9.12 以降では Chasen2 にだけ対応しています。


<li>「かかし」か「茶筌」か ---- とても大雑巴に言うと<br>
かかしの方が簡単 (安定)で速い。<br>
茶筌の方が、少し遅いかも知れないが性能がいい。<br>
ということだと思う。
「茶筌が動けばそれを使う。動かない時にはかかし」
というのも一つの考え方です。
<li>ChaSen 2.02 以前では make install しても
/usr/local/lib/libchasen.a を入れてくれないので、手動で

<pre>
cp libchasen.a /usr/local/lib
ranlib -t /usr/local/lib/libchasen.a
</pre>
とする必要があります。

<li>×となっている File-MMagiz は通常同梱されていて自動で入ります。
<li> namazu 自体の ./configure については <a href="../../INSTALL.ja">INSTALL.ja</a>
を見て下さい。
</ul>

<!-------------------------------------------------------------->
<a name="BEFORE_MAKE_INSTALL"></a>
<h3><a href="#INDEX">mknmz make install 前の確認</a></h3>
もし make install する前に mknmz を試して見たいという時には
cd scripts してから ./mknmz とすると、
<font color="#226644">(/usr/local/share/namazu でなく)</font>
すぐ隣にある ../pl/*.pl を参
照します。
<font size=-1 color="#226644">
(この辺の事情は mknmz の中の load_module() の中の @INC の文字の辺
で分るはずです)。</font>
<br>
例えば
<nobr><tt>
./mknmz -C  ./mknmz --help ./mknmz -O /tmp ~/Mail</tt></nobr>
などを試せます。

<!-------------------------------------------------------------->
<a name="HELP"></a>
<h3><a href="#INDEX">help の表示</a></h3>
以上 mknmz と namazu の二つの使い方は引数無で起動するととても簡単な説明が、
--help と入力すると長い説明が表示されます。また -C を付けると
その時の構成を表示します。この三つ

  <center><table cellspacing=0 cellpadding=3 border>
  <caption>操作行で説明などを得る方法</caption>
  <tr><th rowspan=2>引数</th>           <th rowspan=2>意味</th><th rowspan=2>その他に引数を付けると</th>
    <th colspan=2>実行例</th>
  <tr>                                                         <td>mknmz<td> namazu
  <tr><td>無</td> <td>とても簡単な説明<td>(他の引数・選択は付けられない)
    <td><td>
  <tr><td><tt>--help</tt></td><td>詳しい説明 <td>(他の引数・選択は無視される)
    <td><a href="mknmz-1.9.12--help">*</a>    <td><a href="namazu-1.9.12--help">*</a>
  <tr><td><tt>-C </tt>   </td><td>その時の構成<td> (他の引数・選択も意味がある)
    <td><a href="mknmz-1.9.12-C">*</a>    <td><a href="namazu-1.9.12-C">*</a>
  </table></center>

は覚えておくといいと思います。 
上にも書きましたが、全ての機能については別の
<a href="doc/ja/manual.html">説明書</a> がありますので、そちらを
参照して下さい。

<!-------------------------------------------------------------->
<a name="RUN_MKNMZ"></a>
<h3><a href="#INDEX">動作確認 mknmz</a></h3>
さて、組立たばかりのものを使って、まずは索引を作ります。
<font color="#224466">
(もし make install の前に試したいなら、上の
<a href="#BEFORE_MAKE_INSTALL">
【mknmz make install 前の確認】</a>を見て下さい。)</font>
<br>
これには次のようにします。1.4.0.8 からは少し書式が変っていて
URL の置換は 
<a href="replace.shtml">--replace を使って明示的に指定する</a>
ようになりました。
(但し namazu で表示する時にも REPLACE が出来ます。
mknmz では --replace を指定しないで実行し、
namazu の実行時に
<a href="#NAMAZURC">.namazurc</a> の方で調整する。という方法です。
高林さんは、その方をすすめるようにすると書いています)
  <blockquote>
  <tt><a href="man/mknmz">mknmz</a> [options] <i>検索 directory</i></tt>
  </blockquote>
とします。
この場合、結果の検索索引(index) 
はカレント・ディレクトリに作られます。
もし出力先を変更したい時には -O を使います。
<p>
例えば<blockquote><tt>
  mkdir /tmp/index<br>
  cd /home/htdocs/software<br>
  mknmz -O /tmp/index \<br>
  --replace='s#<font color="#226644">/home/htdocs/software/</font>#<font color="#555500">http://www.ki.nu/software/</font>#'
 <font color="#FF0000">.</font></tt></blockquote>
などとして見ます。(最後の<font color="#FF0000">ピリオド</font>にも注目) <br>
この例は
<ul>
  <li>結果 (の索引) は (-O で指定した) /tmp/index に
  <li>検索対象は<tt>現案内(current directory)</tt> (これが<font color="#FF0000">ピリオド</font>)
  <li>URL については
「<font color="#226644">/home/htdocs/software/</font> に置いてあるものは
外から見ると、
<font color="#555500">
http://www.ki.nu/software/</font> の下に見えるもの
なので、(Perl 語で言うと) 
<tt>s#<font color="#226644">aaa</font>#<font color="#555500">bbb</font># 
のように変換してね」という意味になります。
(上の例では aaa (/home/htdocs/software/)
            bbb ( http://www.ki.nu/) となる。

  <li> (<font color="#226644"  size=-1>/usr/local/share/namazu/conf.pl 
      の $HTML_SUFFIX の設定によって</font>)
     *.html *.html.ja *.phtml *.html *.asp *.cgi などだけを調べ、メー
      ルのようなものは調べない。
  <li>手軽にメールなどを調べるなら -a を付けておく
</ul>
実行の最初の方に次のように表示されますが、
<pre>
 find_target: Scanned : (1267), Files: (1265), Elapsed: (8), Files/sec: (158.1).
</pre>
 find_target という処理の中で、1267 個の譜が見つかったが、
$DENY_REGEX
$EXCLUDE_REGEX 
$ALLOW_REGEX 
$HTML_SUFFIX
などの設定により、そのうち 1265 を処理する。この部分にかかった秒数
は 8, 
一秒に 158 個の割合で譜を調べた。
という意味になります。Scanned/Files の差が自分の意図
と違っている場合は、上記 四変数を調べた方がいいでしょう。
(これらの変数は、通常 
<a href="#MKNMZRC">.mknmzrc</a> 
に設定します。)
<p>


<!--------------------------><a name="USING_MKNMZ">

<hr>
<font color="#226644">この色の情報はまだ以前の情報のままですので
あまり、意味がありません。
<hr>

<a name="CUSTOMIZE_MKNMZ"></a>
<h3><a href="#INDEX">mknmz の調整</a></h3>
<pre>
メール
HTML
その他の形式 (Re: filter)
他の Web
</pre>

mknmz の操作行での選択は、
<a href="man/mknmz">
mknmz --help </a>とすると得られます。また
-C を付けると、その時の構成を表示してくれます。
<pre>
Config: /home/makoto/.mknmzrc
System: netbsd
Namazu: 1.9.5
Perl:   5.00503
NKF:    module_nkf
KAKASI: /usr/local/bin/kakasi -ieuc -oeuc -w
ChaSen: module_chasen1 -j -F '%m '
Wakati: /usr/local/bin/kakasi -ieuc -oeuc -w
Lang:   ja
CCS:    euc
CONFDIR:     /usr/local/share/namazu/conf
LIBDIR:      /usr/local/share/namazu/lib
FILTERDIR:   /usr/local/share/namazu/filter
TEMPLATEDIR: /usr/local/share/namazu/template
Supported media types: 
  application/x-bzip2
  application/x-compress
  application/x-gzip
  message/news
  message/rfc822
  text/html
  text/html; x-type=mhonarc
  text/plain
  text/plain; x-type=rfc
  text/x-roff
</pre>
<!--

    -a, --all                すべてのファイルを対象とする
    -e, --robots-txt         ロボットよけされているファイルを除外する
    -t, --media-type=mtype   対象ファイルの文書形式を指定する
    -h, --mailnews           --media-type='message/rfc822' と同じ
        --mhonarc            --media-type='text/html; x-type=mhonarc' と同じ
    -A, --htaccess           .htaccess で制限されたファイルを除外する
    -F, --target-list=file   インデックス対象のファイルのリストを読み込む
        --allow=regex        対象ファイル名の正規表現を指定する
        --deny=regex         除外するファイル名の正規表現を指定する
        --exclude=regex      除外するパス名の正規表現を指定する
    -M, --meta               HTMLの metaタグをフィールド指定検索に用いる
    -r, --replace=code       URIを置換するためのコードを指定する
-->
<h4>検索を作る対象について</h4>

<table cellspacing=0 cellpadding=3 border>
<tr><th>短縮形</th><th>本名</th><th>説明</th>
<tr><td>-a</td><td>--all</td>        <td>を付けると全て調べる</td></tr>
<tr><td>-e</td><td>--robots-txt</td> <td>ロボットよけされているファイルを除外する</td>
<tr><td>-A</td><td>--htaccess</td>   <td>.htaccess で制限されたファイルを除外する</td>
<tr><td>-F</td><td>--target-list=file</td><td>インデックス対象のファイルのリストを読み込む</td>
<tr><td>-t</td><td>--media-type=mtype</td><td>対象ファイルの文書形式を指定する
<tr><td></td><td>--allow=regex  </td><td>対象ファイル名の正規表現を指定する
<tr><td></td><td>--deny=regex   </td><td>除外するファイル名の正規表現を指定する
<tr><td></td><td>--exclude=regex</td><td>除外するパス名の正規表現を指定する

</table>


現在の版(少なくとも 1.9.5) では
<ul>
<li>
<i>検索 directory</i>に symbolic link があるとうまく行かな
いので、シンボリック・リンクの先をそのまま指定する、つまり
(cd <i>検索 directory</i>; pwd) 
として表示されるものを使うのが無難
</ul>
</font>

<h4>conf.pl</h4>
namazu-1.9.5/lib/conf.pl が設置される先の
<tt><a href="conf.pl">/usr/local/share/namazu/lib/conf.pl</a></tt> 
に定義されている<a href="conf.pl.shtml">変数</a>は
~/.mknmzrc の中に設定変更を書くことが出来る。
(以前は
-I filename と指定した filename の中に書く
方法だけしかなかった)


<pre>このようなものを試して見る。
makoto@milano  22:04:47/991121(~)> 

(準備中)
...
...
[Base]
Date: Sun Nov 21 22:26:03 1999
Added Files: 1,285 files
Total Files: 1,285 files
Size: 672,425 bytes
Added Keywords: 15,672 words
Total Keywords: 15,672 words
Perl: 5.00503
Namazu: 1.9.5
System: netbsd
Wakati: /usr/local/bin/kakasi -ieuc -oeuc -w
Time: 1261 sec.
</pre>

<!-------------------------->
<h3><a href="#INDEX" name="RUN_NAMAZU">【動作確認 namazu】</a></h3>
さまざまな設定は<tt>
<a href="http://openlab.ring.gr.jp/namazu/manual.html.ja#NAMAZU_CONF">
/usr/local/share/namazu/conf/namazu.conf</a></tt>
に書くことが出来ます。
namazu.conf の設定例は 配布の中の <tt>lib/namazu.conf-dist</tt> に
あります。
<p>初めは操作行で <pre>
/usr/local/namazu/bin 検索文字列</pre>
を試すのが手軽です。
<p>
無指定では、namazu は
<tt>/usr/local/share/namazu/index/</tt> に検索索引を見に行きます。
<p>詳しい説明は manual があります。
<a href="doc/ja/manual.html">
<p>
Web で cgi を実行出来るようにするには、いくつかの条件があるかも知
れない。<a href="http://www.apache.org/">apache</a> の場合
<a href="http://www.apache.org/docs/">設定</a>として
<tt>
<table cellspacing=0 cellpadding=3 border>
<tr><td>
ScriptAlias</td><td> /cgi-bin/ /usr/local/apache/cgi-bin/
</td><td>/cgi-bin/ と来た時に、どこを見に行くか</td>
</tr>

<tr><td>
AddHandler</td><td> cgi-script .cgi
</td><td> .cgi と付いていれば cgi として実行する</td>
</tr>

<tr><td>
<a href="http://www.apache.org/docs/mod/core.html#allowoverride">
AllowOverride</a></td><td> All
</td>
<td>.htaccess での設定を有効にする(= 許可する)(管理者)</td>
<tr><td>
Options 
</td>
<td>ExecCGI
<td>cgi-bin の実行を許す
</tr>

<tr><td>
DirectoryIndex</td><td> index.html
</td><td> URL が directory を指している時に探す譜名
</td></tr>

</table>
</tt>
などが関係して来る。(管理者)と書いてあるもの以外は .htaccess にも
書ける(ただし apache の設置時にそれを禁止することも出来るので不可の場合もある)

<p>
<h4>型紙(template)のこと</h4>
/usr/local/share/namazu/template/
<p>
<!-------------------------->
<a name="TERMINOLOGY"></a>
<h3><a href="#INDEX">【用語】</a></h3>
<dl>
<dt><a href="http://kakasi.namazu.org/">Kakasi</a>
<dd>本来は「漢字で書かれたもの」を「ひらがな・カタカナ・roma-ji 」
などに変換する系。しかしここでは次々項の「わかち書き」をする道具とし
て使う。

<dt>
<a href="http://cactus.aist-nara.ac.jp/lab/nlt/chasen.html">Chasen (茶筌)</a>
<dd>「日本語形態素分析器」であるが、やはり同様に「わかち書き」
(正確には日本語の単語の切出し)に使っている。

<dt>わかち書き
<dd>
日本語 は (英語 と 違って)単語 の 区切り に 空白 を 書いたり は しない。
そのまま では 計算機 の 処理 に 不都合 が ある ので、単語毎 に 分けて、
間 に 空白 を 入れて 書いた もの を 利用する。
そういう書き方を「わかち書き」と言う。
(用語としては計算機用語として以外にも同じ意味で使われる)
<dt>インデックス(名詞)
<dd>検索索引<br>
Namazu は<pre>
         (準備)     (検索画面)
          mknmz       namazu
         ↑   ↓     ↑    ↓
元々の資料    検索索引     検索結果
           (インデックス)
</pre>のようにして予め検索索引を作っておき、検索画面での
入力があった時には、それを見て結果を表示するという動作を
する。この「予め作られた「検索索引」のことをインデックス
と呼んでいる。<br>Namazu の場合 NMZ.* のような名前のものが
それにあたる。

<dt>インデックス(動詞)
<dd>上記検索索引を作ること。mknmz を使う
<dt>複数インデックス
<dd>二つ以上の検索索引を作っておいて、それらの中をまとめて
検索する機能

<a href="http://openlab.ring.gr.jp/namazu/manual.html.ja#MULTIPLE_INDICES ">説明書の中に実現方法</a>が書いてある。

<dt>フレーズ検索
<dd>
Namazu の検索の基本は単語の組合せである。
"単語 and 組合せ" と(順を逆にした)
"組合せ and 単語" は区別しない。これを "単語 組合せ"という
文字列がそのままの順で出現するものを探す機能のこと。
<dt>conf.pl
<dd>
1.4 以前は
<pre>
mknmz の実行時の設定が書いてあったが、1.9 では
  1. ~/.mknmzrc
  2. @datadir@/namazu/conf/mknmz.conf

の優先順位で mknmz の設定ファイルを読み込む
mknmz --config=/somewhere/mknmz.conf のような方法で設定ファ
イルを読ませることは出来ない。
</pre>
<a href="conf.pl">
conf.pl</a> 
はまだ残っているが、これは ~/.mknmzrc で
<a href="conf.pl.shtml">
変更したいようなもの</a>の設定がしてある
<dt>mknmz.conf (/usr/local/share/namazu/conf/mknmz.conf)
<dd>mknmz の基本設定を行なう。

<dt>namazu.conf  (/usr/local/share/namazu/conf/namazu.conf)
<dd>
Namazu の動作を make 時から変更したいというような時に、その
設定が書ける。
説明は次のところにある。

<a href="http://openlab.ring.gr.jp/namazu/manual.html.ja#NAMAZU_CONF        ">http://openlab.ring.gr.jp/namazu/manual.html.ja#NAMAZU_CONF</a>
<tt>
INDEX, REPLACE, BASE, WAKATI, LOGGING OFF, LANG ja
</tt>
の設定が出来る。
<dt>Perl 部品化 ( Perl module)
<dd> program を単体としてではなく、 Perl の部品として起動
出来るしくみ<br>
nkf, kakasi, chasen などは以前は  Namazu から外部 process として呼出さ
れるようになっていた。この場合、process を別に起動するということで
時間がかかる。
現在では、これらの perl 部品が用意されて、
perl から部品(module)として呼出されるように出来る。
そうすると process を起動しないで済む分、実行速度が有利になる。
<br>この機能は Namazu-1.3 以前では提供されていない。 
1.4 以降の機能である。
<p><pre>
Namazu に必要な Perl の部品が入っているかどうかは
perl -MText::Kakasi -e ''
perl -MText::ChaSen -e ''
perl -MNKF -e ''
のように入力した時に、何も表示されなければ良い。
</pre>

</dl>


<a name="CAN_DO"></a>
<h3><a href="#INDEX">Namazu で出来ること</a></h3>
<font color="Red">
ここに書いてあることは「保証」ではありません。
</font>
開発者の希望が書いてあるだけです。
<ul>
<li>一つの機械の、一つまたは複数の案内(directory)
の下にある譜を指定して、
<li>それらの中の単語を調べ、どの譜にどの単語が含まれているか
を「索引(index)」に書き出しておく
<li>使用者が入力した文字列と、上記の単語を比べて、
その単語が含まれている譜を(HMTL の形式で)表示すること
<li>上記単語の指定は、単語の一部分でなく単語全体です。
ですから sys と指定しても system は見つかりません。
そのような時には sys* や *sys* のように前後に *
を付けることによって、sys で始まる単語 (sys*)、
sys を含む単語 (*sys*)、
sys で終了する単語 (*sys) と入力します。
<li>以上の操作を設定で英語または日本語の表示とすること
<li>通常索引の作成は Unix に準じる OS
<li>作られた索引の利用は Unix の操作行、または 
cgi-bin が動く HTTP server を 
閲覧系を通じて利用する形で行ないます。
</ul>

<a name="CAN_NOT_DO"></a>
<h3><a href="#INDEX">出来ないこと</a></h3>
<ul>
<li>他の機械にまで内容を取りに行って検索すること
<li>「一日に 100 万回の利用回数がある」というような大規模な構成
の使い方。
</ul>
<a name="OTHERS"></a>
<h3><a href="#INDEX">【その他】</a></h3>
<dl>
<dt>対象譜について
<dd>
指定した「検索 directory 」の中で、
何が検索の対象になるかという疑問があるとしたら、答えは、
<a href="target.shtml">
<font color="#117744">(conf.pl の中か
~/.mknmzrc の)</font>
$TARGET_FILE, $DENY_FILE の設定。それと
-a 選択で決まる</a>。

<dt>mew-1.94b2x と mew-nmz.el
<dd>
mew には namazu と連動して
<ul>
<li>
mknmz を起動して必要な検索索引を作り
<li>
検索した結果を使って virtual folder を作成する
</ul>
機能が contrib/mew-nmz.el にあり、説明は
<a href="00readme-namazu.jis">
contrib/00readme-namazu.jis</a> に書いてあります。

</dl>

</body>
</html>
